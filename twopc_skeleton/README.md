# 2 Phase Commit(2PC)

## 알고리즘 동작 단계

### Prepare

- 트랜잭션 매니저가 리소스 매니저에게 트랜잭션 커밋 준비를 요청
- 리소스 매니저는 요청을 받아 작업을 준비하고 준비가 완료되면 응답

### Commit/Rollback Phase

- 모든 리소스 매니저가 완료되면 트랜잭션 매니저가 트랜잭션을 커밋
- 만약 하나의 리소스 매니저라도 준비되지 않는다면, 트랜잭션 매니저는 트랜잭션을 롤백

## 특징

- 원자성 보장
  - 여러 데이터베이스나 서비스에 걸쳐 있는 트랜잭션을 하나의 트랜잭션처럼 다룰 수 있게 해준다
- Coordinator
  - 코디네이터가 분산 트랜잭션을 관리하고 조율하는 중요한 역할
  - 작업의 상태를 관리하고 최종 커밋, 롤백을 결정

## 문제점

- Coordinator가 SPOF(Single Point of Failure)가 될 수 있다
- 분산된 각 트랜잭션이 모두 완료될 때 까지 서비스가 사용하는 리소스가 잠겨있다
  - 지연 시간이 늘어나고 리소스가 차단
- NoSQL은 2PC를 지원하지 않음

## In Practical

- Spring Boot에서 2PC 구현의 한 가지 방법으로 XA 프로토콜을 사용
- Atomikos, Bitronix